{
	"info": {
		"_postman_id": "bf0242db-792a-4431-bf85-4e80ca9cc2f3",
		"name": "EDC-V Onboarding",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "647585",
		"_collection_link": "https://galactic-star-228409.postman.co/workspace/EDC-V~63c4389d-b024-4df9-a3e9-bf93de272251/collection/647585-bf0242db-792a-4431-bf85-4e80ca9cc2f3?action=share&source=collection_link&creator=647585"
	},
	"item": [
		{
			"name": "Setup Issuer",
			"item": [
				{
					"name": "Create Tenant in IssuerService",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"roles\": [\n        \"admin\"\n    ],\n    \"serviceEndpoints\": [\n        {\n            \"type\": \"IssuerService\",\n            \"serviceEndpoint\": \"http://issuerservice.edc-v.svc.cluster.local:10012/api/issuance/v1alpha/participants/aXNzdWVy\",\n            \"id\": \"issuer-service-1\"\n        }\n    ],\n    \"active\": true,\n    \"participantContextId\": \"issuer\",\n    \"did\": \"did:web:issuerservice.edc-v.svc.cluster.local%3A10016:issuer\",\n    \"key\": {\n        \"keyId\": \"did:web:issuerservice.edc-v.svc.cluster.local%3A10016:issuer#key-1\",\n        \"privateKeyAlias\": \"key-1\",\n        \"keyGeneratorParams\": {\n            \"algorithm\": \"EdDSA\"\n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/issuer/cs/api/identity/v1alpha/participants",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"issuer",
								"cs",
								"api",
								"identity",
								"v1alpha",
								"participants"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create AttestationDefinition",
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"attestationType\": \"membership\",\n    \"configuration\": {\n    },\n    \"id\": \"membership-attestation-def-1\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/issuer/admin/api/admin/v1alpha/participants/aXNzdWVy/attestations",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"issuer",
								"admin",
								"api",
								"admin",
								"v1alpha",
								"participants",
								"aXNzdWVy",
								"attestations"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create CredentialDefinition",
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"attestations\": [\n        \"membership-attestation-def-1\"\n    ],\n    \"credentialType\": \"MembershipCredential\",\n    \"id\": \"membership-credential-def\",\n    \"jsonSchema\": \"{}\",\n    \"jsonSchemaUrl\": \"https://example.com/schema/membership-credential.json\",\n    \"mappings\": [\n        {\n              \"input\": \"membership\",\n              \"output\": \"credentialSubject.membership\",\n              \"required\": true\n        },\n        {\n            \"input\": \"membershipType\",\n            \"output\": \"credentialSubject.membershipType\",\n            \"required\": \"true\"\n        },\n        {\n            \"input\": \"membershipStartDate\",\n            \"output\": \"credentialSubject.membershipStartDate\",\n            \"required\": true\n        }\n    ],\n    \"rules\": [],\n    \"format\": \"VC1_0_JWT\",\n    \"validity\": \"604800\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/issuer/admin/api/admin/v1alpha/participants/aXNzdWVy/credentialdefinitions",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"issuer",
								"admin",
								"api",
								"admin",
								"v1alpha",
								"participants",
								"aXNzdWVy",
								"credentialdefinitions"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Create Consumer Tenant",
			"item": [
				{
					"name": "Create Consumer Client in KeyCloak",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "oauth2",
							"oauth2": [
								{
									"key": "tokenName",
									"value": "kc-admin-access",
									"type": "string"
								},
								{
									"key": "tokenType",
									"value": "Bearer",
									"type": "string"
								},
								{
									"key": "accessToken",
									"value": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJHX29YUWE3dVNmRkZLZmdpMmtCNV9nTUF6OW5HNTRJLUpBSVZLa0cxMmpNIn0.eyJleHAiOjE3NjI1MjI4ODUsImlhdCI6MTc2MjUyMjgyNSwianRpIjoib25sdHJ0OjExODk0NDhlLWNlNzMtZTk4MC02NmVlLTJmYzRlNjJhYmQ0OSIsImlzcyI6Imh0dHA6Ly9rZXljbG9hay5sb2NhbGhvc3QvcmVhbG1zL21hc3RlciIsInR5cCI6IkJlYXJlciIsImF6cCI6ImFkbWluLWNsaSIsInNpZCI6IjA2N2Y2MzAyLTJhNmItY2MwZS1lOTYwLTQ1MDcyMWEwZTViZiIsInNjb3BlIjoicHJvZmlsZSBlbWFpbCJ9.KdX2D4ibX2xHsTJX48ai-6Shi8_74_zbUAJ2zSZ4y3MvxNUn9JBGGkMy-GNV6xFWe1GpWr0_7RVtQIz9jc9g66xncpT_ktu05ZN8N-dm6PU_SJNpJVSEi8EU2cc1iThya2vgawJqi8R8Vy3uluiIMkAez5m7CVvdpKDnlCtBS3QBEiAvdXsGGCtpjEadhUnq-iBlBNeY5pAH4yapxM3wF01GWskbIUbU93M8xzupsoaPKa8AnA561eIWvZ6kN0X-R5n8L6z5Fh9JGHpR2HqcfcLfddGgxuZDkXCTGHQdVEAfswKrZ9ea3217wG9WUTY-6G6lDs95RiesipiXMq-xhg",
									"type": "string"
								},
								{
									"key": "accessTokenUrl",
									"value": "http://keycloak.localhost/realms/master/protocol/openid-connect/token",
									"type": "string"
								},
								{
									"key": "grant_type",
									"value": "password_credentials",
									"type": "string"
								},
								{
									"key": "scope",
									"value": "",
									"type": "string"
								},
								{
									"key": "clientId",
									"value": "admin-cli",
									"type": "string"
								},
								{
									"key": "clientSecret",
									"value": "",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "addTokenTo",
									"value": "header",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"clientId\": \"consumer\",\n    \"name\": \"Consumer Client\",\n    \"description\": \"Tenant client for API access\",\n    \"enabled\": true,\n    \"secret\": \"consumer-secret\",\n    \"protocol\": \"openid-connect\",\n    \"publicClient\": false,\n    \"serviceAccountsEnabled\": true,\n    \"standardFlowEnabled\": false,\n    \"directAccessGrantsEnabled\": false,\n    \"fullScopeAllowed\": true,\n    \"protocolMappers\": [\n        {\n            \"name\": \"participantContextId\",\n            \"protocol\": \"openid-connect\",\n            \"protocolMapper\": \"oidc-hardcoded-claim-mapper\",\n            \"consentRequired\": false,\n            \"config\": {\n                \"claim.name\": \"participant_context_id\",\n                \"claim.value\": \"consumer\",\n                \"jsonType.label\": \"String\",\n                \"access.token.claim\": \"true\",\n                \"id.token.claim\": \"true\",\n                \"userinfo.token.claim\": \"true\"\n            }\n        },\n        {\n            \"name\": \"role\",\n            \"protocol\": \"openid-connect\",\n            \"protocolMapper\": \"oidc-hardcoded-claim-mapper\",\n            \"consentRequired\": false,\n            \"config\": {\n                \"claim.name\": \"role\",\n                \"claim.value\": \"edcv-participant\",\n                \"jsonType.label\": \"String\",\n                \"access.token.claim\": \"true\",\n                \"id.token.claim\": \"true\",\n                \"userinfo.token.claim\": \"true\"\n            }\n        }\n    ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://keycloak.localhost/admin/realms/edcv/clients",
							"protocol": "http",
							"host": [
								"keycloak",
								"localhost"
							],
							"path": [
								"admin",
								"realms",
								"edcv",
								"clients"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Consumer Holder in IssuerService",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"did\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer\",\n    \"holderId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer\",\n    \"name\": \"consumer tenant\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/issuer/admin/api/admin/v1alpha/participants/aXNzdWVy/holders",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"issuer",
								"admin",
								"api",
								"admin",
								"v1alpha",
								"participants",
								"aXNzdWVy",
								"holders"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Consumer Tenant in IdentityHub",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Parse JSON response and store clientId and clientSecret as collection variables",
									"let jsonData;",
									"",
									"pm.test(\"Response is valid JSON\", function () {",
									"    try {",
									"        jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.be.an(\"object\");",
									"    } catch (e) {",
									"        throw new Error(\"Response body is not valid JSON\");",
									"    }",
									"});",
									"",
									"pm.test(\"Response contains apiKey, clientId and clientSecret\", function () {",
									"    pm.expect(jsonData).to.have.property(\"clientId\");",
									"    pm.expect(jsonData).to.have.property(\"clientSecret\");",
									"    pm.expect(jsonData).to.have.property(\"apiKey\");",
									"});",
									"",
									"if (jsonData && jsonData.clientId && jsonData.clientSecret) {",
									"    pm.collectionVariables.set(\"tenant_clientId\", jsonData.clientId);",
									"    pm.collectionVariables.set(\"tenant_clientSecret\", jsonData.clientSecret);",
									"    pm.collectionVariables.set(\"tenant_apiKey\", jsonData.apiKey);",
									"} "
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"roles\": [],\n    \"serviceEndpoints\": [\n        {\n            \"type\": \"CredentialService\",\n            \"serviceEndpoint\": \"http://identityhub.edc-v.svc.cluster.local:7082/api/credentials/v1/participants/Y29uc3VtZXI=\",\n            \"id\": \"consumer-credentialservice-1\"\n        },\n        {\n            \"type\": \"ProtocolEndpoint\",\n            \"serviceEndpoint\": \"http://controlplane.edc-v.svc.cluster.local:8082/api/dsp/consumer/2025-1\",\n            \"id\": \"consumer-dsp\"\n        }\n    ],\n    \"active\": true,\n    \"participantContextId\": \"consumer\",\n    \"did\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer\",\n    \"key\": {\n        \"keyId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer#key-1\",\n        \"privateKeyAlias\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer#key-1\",\n        \"keyGeneratorParams\": {\n            \"algorithm\": \"EC\"\n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cs/api/identity/v1alpha/participants",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cs",
								"api",
								"identity",
								"v1alpha",
								"participants"
							]
						}
					},
					"response": []
				},
				{
					"name": "Request Credentials",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"issuerDid\": \"did:web:issuerservice.edc-v.svc.cluster.local%3A10016:issuer\",\n    \"holderPid\": \"credential-request-5\",\n    \"credentials\": [{\n        \"format\": \"VC1_0_JWT\",\n        \"type\": \"MembershipCredential\",\n        \"id\": \"membership-credential-def\"\n    }]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cs/api/identity/v1alpha/participants/Y29uc3VtZXI=/credentials/request",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cs",
								"api",
								"identity",
								"v1alpha",
								"participants",
								"Y29uc3VtZXI=",
								"credentials",
								"request"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Consumer in Control Plane",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "oauth2",
							"oauth2": [
								{
									"key": "tokenName",
									"value": "admin-access",
									"type": "string"
								},
								{
									"key": "clientSecret",
									"value": "edc-v-admin-secret",
									"type": "string"
								},
								{
									"key": "scope",
									"value": "management-api:read management-api:write identity-api:read identity-api:write",
									"type": "string"
								},
								{
									"key": "clientId",
									"value": "edcv-admin",
									"type": "string"
								},
								{
									"key": "accessTokenUrl",
									"value": "http://keycloak.localhost/realms/edcv/protocol/openid-connect/token",
									"type": "string"
								},
								{
									"key": "grant_type",
									"value": "client_credentials",
									"type": "string"
								},
								{
									"key": "tokenType",
									"value": "Bearer",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "addTokenTo",
									"value": "header",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"participantContextId\": \"consumer\",\n    \"participantId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer\",\n    \"isActive\": true,\n    \"tokenUrl\": \"http://identityhub.edc-v.svc.cluster.local:7084/api/sts/token\",\n    \"clientSecret\": \"{{tenant_clientSecret}}\",\n    \"clientId\": \"{{tenant_clientId}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cp/api/mgmt/v1alpha/participants",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cp",
								"api",
								"mgmt",
								"v1alpha",
								"participants"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Create Provider Tenant",
			"item": [
				{
					"name": "Create Provider Client in KeyCloak",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "oauth2",
							"oauth2": [
								{
									"key": "tokenType",
									"value": "Bearer",
									"type": "string"
								},
								{
									"key": "accessToken",
									"value": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJWaTZ3ZWhrTjk0VTNpUE5mNDNVLWJjbHVwbVFBNVl5aDVKWHNBa2c2MUJNIn0.eyJleHAiOjE3NjI4NDE0NTMsImlhdCI6MTc2Mjg0MTM5MywianRpIjoib25sdHJ0OmNmOGRmN2VhLWZhYTAtNjU1Mi1mMjEzLThhNjI5Njc3ZWVkMyIsImlzcyI6Imh0dHA6Ly9rZXljbG9hay5sb2NhbGhvc3QvcmVhbG1zL21hc3RlciIsInR5cCI6IkJlYXJlciIsImF6cCI6ImFkbWluLWNsaSIsInNpZCI6ImE0MGJlMjgwLWRkYTktNTUwYy04YzU5LTA3MGYwYjhmZDNlMyIsInNjb3BlIjoicHJvZmlsZSBlbWFpbCJ9.DSsv-pfhTs3t2_9GNS99DpYS0GB-gIiABDODPc9FtPp4aFoGSBx5PNcvTk4-pljJDZsY9T6VchwOer2yQ1dcNpheP-AIInD87hJaF0mHagf-pjhUFq9pCR2iXAvL1PgHBB6Sif3TJWZ13FAlltt9GO_AWamqT9V53B4pPcLH6ujBD8GdN8jd2tknWsx6R8A8hCL2pRpr8YSOvu8A4nmdxigzQ5WqRJmlQUNUmlnyhE6xvsE7nSygfpqe7FFvC-PluXUol9RAwtX0barFOMdKWFaCfvEs0Bvq3USXW4tRxds7Paf30H7JdHJBvnaqCAl6N8c8LCMhbr852sTW4FMkww",
									"type": "string"
								},
								{
									"key": "tokenName",
									"value": "kc-admin-access",
									"type": "string"
								},
								{
									"key": "accessTokenUrl",
									"value": "http://keycloak.localhost/realms/master/protocol/openid-connect/token",
									"type": "string"
								},
								{
									"key": "grant_type",
									"value": "password_credentials",
									"type": "string"
								},
								{
									"key": "scope",
									"value": "",
									"type": "string"
								},
								{
									"key": "clientId",
									"value": "admin-cli",
									"type": "string"
								},
								{
									"key": "clientSecret",
									"value": "",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "addTokenTo",
									"value": "header",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"clientId\": \"provider\",\n    \"name\": \"Provider Client\",\n    \"description\": \"Tenant client for API access\",\n    \"enabled\": true,\n    \"secret\": \"provider-secret\",\n    \"protocol\": \"openid-connect\",\n    \"publicClient\": false,\n    \"serviceAccountsEnabled\": true,\n    \"standardFlowEnabled\": false,\n    \"directAccessGrantsEnabled\": false,\n    \"fullScopeAllowed\": true,\n    \"protocolMappers\": [\n        {\n            \"name\": \"participantContextId\",\n            \"protocol\": \"openid-connect\",\n            \"protocolMapper\": \"oidc-hardcoded-claim-mapper\",\n            \"consentRequired\": false,\n            \"config\": {\n                \"claim.name\": \"participant_context_id\",\n                \"claim.value\": \"provider\",\n                \"jsonType.label\": \"String\",\n                \"access.token.claim\": \"true\",\n                \"id.token.claim\": \"true\",\n                \"userinfo.token.claim\": \"true\"\n            }\n        },\n        {\n            \"name\": \"role\",\n            \"protocol\": \"openid-connect\",\n            \"protocolMapper\": \"oidc-hardcoded-claim-mapper\",\n            \"consentRequired\": false,\n            \"config\": {\n                \"claim.name\": \"role\",\n                \"claim.value\": \"edcv-participant\",\n                \"jsonType.label\": \"String\",\n                \"access.token.claim\": \"true\",\n                \"id.token.claim\": \"true\",\n                \"userinfo.token.claim\": \"true\"\n            }\n        }\n    ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{KC_HOST}}/admin/realms/edcv/clients",
							"host": [
								"{{KC_HOST}}"
							],
							"path": [
								"admin",
								"realms",
								"edcv",
								"clients"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Provider Holder in IssuerService",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"did\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\",\n    \"holderId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\",\n    \"name\": \"provider tenant\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/issuer/admin/api/admin/v1alpha/participants/aXNzdWVy/holders",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"issuer",
								"admin",
								"api",
								"admin",
								"v1alpha",
								"participants",
								"aXNzdWVy",
								"holders"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Provider Tenant in IdentityHub",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Parse JSON response and store clientId and clientSecret as collection variables",
									"let jsonData;",
									"",
									"pm.test(\"Response is valid JSON\", function () {",
									"    try {",
									"        jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.be.an(\"object\");",
									"    } catch (e) {",
									"        throw new Error(\"Response body is not valid JSON\");",
									"    }",
									"});",
									"",
									"pm.test(\"Response contains apiKey, clientId and clientSecret\", function () {",
									"    pm.expect(jsonData).to.have.property(\"clientId\");",
									"    pm.expect(jsonData).to.have.property(\"clientSecret\");",
									"    pm.expect(jsonData).to.have.property(\"apiKey\");",
									"});",
									"",
									"if (jsonData && jsonData.clientId && jsonData.clientSecret) {",
									"    pm.collectionVariables.set(\"tenant_clientId\", jsonData.clientId);",
									"    pm.collectionVariables.set(\"tenant_clientSecret\", jsonData.clientSecret);",
									"    pm.collectionVariables.set(\"tenant_apiKey\", jsonData.apiKey);",
									"} "
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"roles\": [],\n    \"serviceEndpoints\": [\n        {\n            \"type\": \"CredentialService\",\n            \"serviceEndpoint\": \"http://identityhub.edc-v.svc.cluster.local:7082/api/credentials/v1/participants/cHJvdmlkZXI=\",\n            \"id\": \"provider-credentialservice-1\"\n        },\n        {\n            \"type\": \"ProtocolEndpoint\",\n            \"serviceEndpoint\": \"http://controlplane.edc-v.svc.cluster.local:8082/api/dsp/provider/2025-1\",\n            \"id\": \"provider-dsp\"\n        }\n    ],\n    \"active\": true,\n    \"participantId\": \"provider\",\n    \"participantContextId\": \"provider\",\n    \"did\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\",\n    \"key\": {\n        \"keyId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider#key-1\",\n        \"privateKeyAlias\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider#key-1\",\n        \"keyGeneratorParams\": {\n            \"algorithm\": \"EC\"\n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cs/api/identity/v1alpha/participants",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cs",
								"api",
								"identity",
								"v1alpha",
								"participants"
							]
						}
					},
					"response": []
				},
				{
					"name": "Request Credentials",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"issuerDid\": \"did:web:issuerservice.edc-v.svc.cluster.local%3A10016:issuer\",\n    \"holderPid\": \"credential-request-1\",\n    \"credentials\": [{\n        \"format\": \"VC1_0_JWT\",\n        \"type\": \"MembershipCredential\",\n        \"id\": \"membership-credential-def\"\n    }]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cs/api/identity/v1alpha/participants/cHJvdmlkZXI=/credentials/request",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cs",
								"api",
								"identity",
								"v1alpha",
								"participants",
								"cHJvdmlkZXI=",
								"credentials",
								"request"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Provider in Control Plane",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "oauth2",
							"oauth2": [
								{
									"key": "tokenType",
									"value": "Bearer",
									"type": "string"
								},
								{
									"key": "accessToken",
									"value": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI1RDVSVlVKU0txTVhkZGl5Y3J5OUNwMkU0azRaQi1BMXlkMjdaOWZGcWVFIn0.eyJleHAiOjE3NjI4NDE3MDUsImlhdCI6MTc2Mjg0MTQwNSwianRpIjoidHJydGNjOjFlN2VlZjIyLWIwYmQtMGM3MC04N2JhLTY4NGIxYjYzN2VlYSIsImlzcyI6Imh0dHA6Ly9rZXljbG9hay5sb2NhbGhvc3QvcmVhbG1zL2VkY3YiLCJzdWIiOiIxNjJmMjM4Yy03NmIyLTQ1NDgtOWE0MS02MDBjNDZmNGVmOGEiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJlZGN2LWFkbWluIiwic2NvcGUiOiJpZGVudGl0eS1hcGk6cmVhZCBtYW5hZ2VtZW50LWFwaTp3cml0ZSBtYW5hZ2VtZW50LWFwaTpyZWFkIGlkZW50aXR5LWFwaTp3cml0ZSIsInJvbGUiOiJlZGN2LWFkbWluIn0.nXlEEG8FTCpfIKGLmojWOupMDokcvJd6LVjsNLBKaBKaAw4PumCjxNl3IBjKu5tSX2MI1QeRokU_Z1i8w3_mWbl_MEmK55rq0ZHOSltI9PqlhmgMfn9YnHAtpF9qz85EPBZ6DWBU8EcIJnm6cbhF8Menv80bSnV6ziJq4zkZqjBk24lzITfd5vssBhHjuYM3G6kazGqANSIaQZw-qKLuJH9e5aYpbm5r4WmrUClD6P-8hoFvp_MgMI0LcwWSkvC2taxApiD_NRHlBjpUfflouRf-nLDe8qm02DcYMtzCc1_skDjb2OJgXZS7dg4a0Wr4TfY-O8nHcnvVhZnZai6mLg",
									"type": "string"
								},
								{
									"key": "tokenName",
									"value": "kc-admin-access",
									"type": "string"
								},
								{
									"key": "accessTokenUrl",
									"value": "http://keycloak.localhost/realms/master/protocol/openid-connect/token",
									"type": "string"
								},
								{
									"key": "grant_type",
									"value": "password_credentials",
									"type": "string"
								},
								{
									"key": "scope",
									"value": "",
									"type": "string"
								},
								{
									"key": "clientId",
									"value": "admin-cli",
									"type": "string"
								},
								{
									"key": "clientSecret",
									"value": "",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "addTokenTo",
									"value": "header",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"participantContextId\": \"provider\",\n    \"participantId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\",\n    \"isActive\": true,\n    \"tokenUrl\": \"http://identityhub.edc-v.svc.cluster.local:7084/api/sts/token\",\n    \"clientSecret\": \"{{tenant_clientSecret}}\",\n    \"clientId\": \"{{tenant_clientId}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cp/api/mgmt/v1alpha/participants",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cp",
								"api",
								"mgmt",
								"v1alpha",
								"participants"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Data Transfer",
			"item": [
				{
					"name": "Get Catalog",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"try {",
									"    const json = pm.response.json();",
									"",
									"    // Navigate the expected structure: Catalog -> dataset[0] -> hasPolicy[0] -> @id",
									"    const datasets = json.dataset || [];",
									"    const firstDataset = datasets[0] || {};",
									"    const policies = firstDataset.hasPolicy || [];",
									"    const firstPolicy = policies[0] || {};",
									"    const policyId = firstPolicy['@id'];",
									"",
									"    if (policyId && typeof policyId === 'string') {",
									"        pm.collectionVariables.set('POLICY_ID', policyId);",
									"        console.log('POLICY_ID set to:', policyId);",
									"    } else {",
									"        console.warn('Policy ID not found in response at dataset[0].hasPolicy[0][\"@id\"]');",
									"    }",
									"",
									"    // Optional: assertion to ensure it exists",
									"    pm.test('Policy ID is present and stored', function () {",
									"        pm.expect(policyId, 'Policy ID should exist').to.be.a('string').and.not.empty;",
									"    });",
									"",
									"} catch (e) {",
									"    console.error('Failed to parse response or set POLICY_ID:', e);",
									"    pm.test('Response is valid JSON', function () {",
									"        throw e;",
									"    });",
									"}"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "oauth2",
							"oauth2": [
								{
									"key": "tokenType",
									"value": "Bearer",
									"type": "string"
								},
								{
									"key": "accessToken",
									"value": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI1RDVSVlVKU0txTVhkZGl5Y3J5OUNwMkU0azRaQi1BMXlkMjdaOWZGcWVFIn0.eyJleHAiOjE3NjI4NDEzMzUsImlhdCI6MTc2Mjg0MTAzNSwianRpIjoidHJydGNjOmU0ZTBjNjk2LWU5MjktMDNmOC03NGRmLWQxNDQ0ZTEwMDhkYiIsImlzcyI6Imh0dHA6Ly9rZXljbG9hay5sb2NhbGhvc3QvcmVhbG1zL2VkY3YiLCJzdWIiOiJhZjgyOTVmNC0zYmRjLTRhOWMtODVkMi1lZDc3NzgxMTdiMDEiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJjb25zdW1lciIsInNjb3BlIjoibWFuYWdlbWVudC1hcGk6d3JpdGUgbWFuYWdlbWVudC1hcGk6cmVhZCIsInJvbGUiOiJlZGN2LXBhcnRpY2lwYW50IiwicGFydGljaXBhbnRfY29udGV4dF9pZCI6ImNvbnN1bWVyIn0.XBJZTav8iasC_CGqbfulxXLDzCk_EYmdgTuM02Jhpmu5AlKEF9LGL4tXE0-Tu_dlpaq5gaIMpu1QvwYYbo2y79AiTY-oNCTX9T4PWOSlEXiaHe8-QESWlFx_JRolpNL4rSdIiZlUgsGqrPWmJfWpvNArGM0hl41fZE4tMqX7wjP3JpK8R50M7ApEDRlBx4sm44ItxyZ5TFGYSNXSGT9eM_lnsAynPB6wQcIuk20mdp1NrYR8tN3xZj_4nSc2OrHZGwd1AN07FNKhYXS66w5lkIuB1S8OHM_h0nUcBX887IOqP1GDlBreir41c38bddg4I34JH2QZeTKBqljfTQoVMg",
									"type": "string"
								},
								{
									"key": "tokenName",
									"value": "kc-admin-access",
									"type": "string"
								},
								{
									"key": "accessTokenUrl",
									"value": "http://keycloak.localhost/realms/master/protocol/openid-connect/token",
									"type": "string"
								},
								{
									"key": "grant_type",
									"value": "password_credentials",
									"type": "string"
								},
								{
									"key": "scope",
									"value": "",
									"type": "string"
								},
								{
									"key": "clientId",
									"value": "admin-cli",
									"type": "string"
								},
								{
									"key": "clientSecret",
									"value": "",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "addTokenTo",
									"value": "header",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n\"counterPartyDid\":\"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cp/api/mgmt/v1alpha/participants/consumer/catalog",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cp",
								"api",
								"mgmt",
								"v1alpha",
								"participants",
								"consumer",
								"catalog"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Data",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "oauth2",
							"oauth2": [
								{
									"key": "tokenName",
									"value": "kc-admin-access",
									"type": "string"
								},
								{
									"key": "tokenType",
									"value": "Bearer",
									"type": "string"
								},
								{
									"key": "accessTokenUrl",
									"value": "http://keycloak.localhost/realms/master/protocol/openid-connect/token",
									"type": "string"
								},
								{
									"key": "grant_type",
									"value": "password_credentials",
									"type": "string"
								},
								{
									"key": "scope",
									"value": "",
									"type": "string"
								},
								{
									"key": "clientId",
									"value": "admin-cli",
									"type": "string"
								},
								{
									"key": "clientSecret",
									"value": "",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "addTokenTo",
									"value": "header",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"providerId\":\"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\",\n    \"policyId\": \"{{POLICY_ID}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cp/api/mgmt/v1alpha/participants/consumer/data",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cp",
								"api",
								"mgmt",
								"v1alpha",
								"participants",
								"consumer",
								"data"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Experimental",
			"item": [
				{
					"name": "Get Asset (using new Mgmt API)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "oauth2",
							"oauth2": [
								{
									"key": "tokenType",
									"value": "Bearer",
									"type": "string"
								},
								{
									"key": "accessToken",
									"value": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI0WWtQM0dTdGVvV0xpNzdlTmdzWHJsNlZDd1dUUFBBUXhkMjdPQnQxQUxJIn0.eyJleHAiOjE3NjI1MTk1OTEsImlhdCI6MTc2MjUxOTUzMSwianRpIjoib25sdHJ0OjRiMmVkODViLTIzZmYtMGUxNC0yODFmLTMyNWUxZmQ1NmQ0OSIsImlzcyI6Imh0dHA6Ly9rZXljbG9hay5sb2NhbGhvc3QvcmVhbG1zL21hc3RlciIsInR5cCI6IkJlYXJlciIsImF6cCI6ImFkbWluLWNsaSIsInNpZCI6IjQ1NDljMWJmLWIxM2ItMDVjMy1mNDkwLWRlNmUyYmJjNmFkNSIsInNjb3BlIjoiZW1haWwgcHJvZmlsZSJ9.S8GPWfWyudk0Zh0orHk8LOutDXmL1hhUWcOAG7jzcYjko8eMAEtBqoqTivNUVyorIfk-J1ohwrlNuBE_dQzm9QzlS01UEyERkZmksBEyHmzMauA9IF3SyDMqeuIDpyTWU0zuWZtnOgaatsrETVqPHifMXbB5E1XkGQtHLIbxiukBSwG8aydA_jKkgC2A53Gu6lIgYGwZAiergO_nliWkXily_GvZZY3GY6KOKAM_gZwTPR8ppkeABZP0xNAeW-K_RnkhvfTQs0bHTyCZ910z21sM1kJTKGSCbSi7ejPMprZnqIqVogKSo2gvCp40pmKWs6cE-aK0BxvmNHSgsi-wyg",
									"type": "string"
								},
								{
									"key": "clientSecret",
									"value": "consumer-secret",
									"type": "string"
								},
								{
									"key": "accessTokenUrl",
									"value": "http://keycloak.localhost/realms/edcv/protocol/openid-connect/token",
									"type": "string"
								},
								{
									"key": "scope",
									"value": "management-api:write management-api:read",
									"type": "string"
								},
								{
									"key": "clientId",
									"value": "consumer",
									"type": "string"
								},
								{
									"key": "grant_type",
									"value": "client_credentials",
									"type": "string"
								},
								{
									"key": "tokenName",
									"value": "edc-v-access",
									"type": "string"
								},
								{
									"key": "addTokenTo",
									"value": "header",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseURL}}/cp/api/mgmt/v4alpha/participants/consumer/assets/d61e6755-3594-48e6-9106-b670211deb6e",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cp",
								"api",
								"mgmt",
								"v4alpha",
								"participants",
								"consumer",
								"assets",
								"d61e6755-3594-48e6-9106-b670211deb6e"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Asset (using new Mgmt API)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "oauth2",
							"oauth2": [
								{
									"key": "accessTokenUrl",
									"value": "http://keycloak.localhost/realms/edcv/protocol/openid-connect/token",
									"type": "string"
								},
								{
									"key": "clientSecret",
									"value": "1KjSm7GixsOp4PDG4fyqGNbFJKiiuisH",
									"type": "string"
								},
								{
									"key": "scope",
									"value": "management-api:write management-api:read",
									"type": "string"
								},
								{
									"key": "clientId",
									"value": "consumer",
									"type": "string"
								},
								{
									"key": "grant_type",
									"value": "client_credentials",
									"type": "string"
								},
								{
									"key": "tokenName",
									"value": "edc-v-access",
									"type": "string"
								},
								{
									"key": "addTokenTo",
									"value": "header",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"@context\": [\n    \"https://w3id.org/edc/connector/management/v0.0.1\"\n  ],\n  \"@id\": \"asset-1\",\n  \"@type\": \"Asset\",\n  \"properties\": {\n    \"description\": \"This asset requires Membership to view and negotiate.\"\n  },\n  \"dataAddress\": {\n    \"@type\": \"DataAddress\",\n    \"type\": \"HttpData\",\n    \"baseUrl\": \"https://jsonplaceholder.typicode.com/todos\",\n    \"proxyPath\": \"true\",\n    \"proxyQueryParams\": \"true\"\n  }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cp/api/mgmt/v4alpha/participants/consumer/assets",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cp",
								"api",
								"mgmt",
								"v4alpha",
								"participants",
								"consumer",
								"assets"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					"// Append-only: status code is any 2xx or 409, considering numeric and string descriptions",
					"pm.test(\"Status code is 2xx or 409\", function () {",
					"    const code = pm.response.code; // numeric",
					"",
					"    const is2xx = code >= 200 && code < 300;",
					"    const is409 = code === 409;",
					"",
					"    pm.expect(is2xx || is409, `Expected 2xx or 409. Got ${code} ${pm.response.status}`).to.be.true;",
					"});"
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseURL",
			"value": "http://localhost"
		},
		{
			"key": "issuer_apiKey",
			"value": ""
		},
		{
			"key": "issuer_clientId",
			"value": ""
		},
		{
			"key": "issuer_clientSecret",
			"value": ""
		},
		{
			"key": "tenant_clientId",
			"value": ""
		},
		{
			"key": "tenant_clientSecret",
			"value": ""
		},
		{
			"key": "tenant_apiKey",
			"value": ""
		},
		{
			"key": "POLICY_ID",
			"value": ""
		},
		{
			"key": "KC_HOST",
			"value": "http://keycloak.localhost"
		}
	]
}