{
	"info": {
		"_postman_id": "ff41b042-89e0-43f6-b94d-68d4c0b20a9d",
		"name": "EDC-V Onboarding",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "647585",
		"_collection_link": "https://galactic-star-228409.postman.co/workspace/EDC-V~63c4389d-b024-4df9-a3e9-bf93de272251/collection/647585-ff41b042-89e0-43f6-b94d-68d4c0b20a9d?action=share&source=collection_link&creator=647585"
	},
	"item": [
		{
			"name": "Setup Issuer",
			"item": [
				{
					"name": "Create Tenant in IssuerService",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Parse JSON response and store clientId and clientSecret as collection variables",
									"let jsonData;",
									"",
									"pm.test(\"Response is valid JSON\", function () {",
									"    try {",
									"        jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.be.an(\"object\");",
									"    } catch (e) {",
									"        throw new Error(\"Response body is not valid JSON\");",
									"    }",
									"});",
									"",
									"pm.test(\"Response contains apiKey, clientId and clientSecret\", function () {",
									"    pm.expect(jsonData).to.have.property(\"clientId\");",
									"    pm.expect(jsonData).to.have.property(\"clientSecret\");",
									"    pm.expect(jsonData).to.have.property(\"apiKey\");",
									"});",
									"",
									"if (jsonData && jsonData.clientId && jsonData.clientSecret) {",
									"    pm.collectionVariables.set(\"issuer_apiKey\", jsonData.apiKey);",
									"    pm.collectionVariables.set(\"issuer_clientId\", jsonData.clientId);",
									"    pm.collectionVariables.set(\"issuer_clientSecret\", jsonData.clientSecret);",
									"} "
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"roles\": [\n        \"admin\"\n    ],\n    \"serviceEndpoints\": [\n        {\n            \"type\": \"IssuerService\",\n            \"serviceEndpoint\": \"http://issuerservice.edc-v.svc.cluster.local:10012/api/issuance/v1alpha/participants/aXNzdWVy\",\n            \"id\": \"issuer-service-1\"\n        }\n    ],\n    \"active\": true,\n    \"participantContextId\": \"issuer\",\n    \"did\": \"did:web:issuerservice.edc-v.svc.cluster.local%3A10016:issuer\",\n    \"key\": {\n        \"keyId\": \"did:web:issuerservice.edc-v.svc.cluster.local%3A10016:issuer#key-1\",\n        \"privateKeyAlias\": \"key-1\",\n        \"keyGeneratorParams\": {\n            \"algorithm\": \"EdDSA\"\n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/issuer/cs/api/identity/v1alpha/participants",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"issuer",
								"cs",
								"api",
								"identity",
								"v1alpha",
								"participants"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create AttestationDefinition",
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"attestationType\": \"membership\",\n    \"configuration\": {\n    },\n    \"id\": \"membership-attestation-def-1\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/issuer/admin/api/admin/v1alpha/participants/aXNzdWVy/attestations",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"issuer",
								"admin",
								"api",
								"admin",
								"v1alpha",
								"participants",
								"aXNzdWVy",
								"attestations"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create CredentialDefinition",
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"attestations\": [\n        \"membership-attestation-def-1\"\n    ],\n    \"credentialType\": \"MembershipCredential\",\n    \"id\": \"membership-credential-def\",\n    \"jsonSchema\": \"{}\",\n    \"jsonSchemaUrl\": \"https://example.com/schema/membership-credential.json\",\n    \"mappings\": [\n        {\n              \"input\": \"membership\",\n              \"output\": \"credentialSubject.membership\",\n              \"required\": true\n        },\n        {\n            \"input\": \"membershipType\",\n            \"output\": \"credentialSubject.membershipType\",\n            \"required\": \"true\"\n        },\n        {\n            \"input\": \"membershipStartDate\",\n            \"output\": \"credentialSubject.membershipStartDate\",\n            \"required\": true\n        }\n    ],\n    \"rules\": [],\n    \"format\": \"VC1_0_JWT\",\n    \"validity\": \"604800\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/issuer/admin/api/admin/v1alpha/participants/aXNzdWVy/credentialdefinitions",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"issuer",
								"admin",
								"api",
								"admin",
								"v1alpha",
								"participants",
								"aXNzdWVy",
								"credentialdefinitions"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Create Consumer Tenant",
			"item": [
				{
					"name": "Create Consumer Holder in IssuerService",
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"did\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer\",\n    \"holderId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer\",\n    \"name\": \"consumer tenant\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/issuer/admin/api/admin/v1alpha/participants/aXNzdWVy/holders",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"issuer",
								"admin",
								"api",
								"admin",
								"v1alpha",
								"participants",
								"aXNzdWVy",
								"holders"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Consumer Tenant in IdentityHub",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Parse JSON response and store clientId and clientSecret as collection variables",
									"let jsonData;",
									"",
									"pm.test(\"Response is valid JSON\", function () {",
									"    try {",
									"        jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.be.an(\"object\");",
									"    } catch (e) {",
									"        throw new Error(\"Response body is not valid JSON\");",
									"    }",
									"});",
									"",
									"pm.test(\"Response contains apiKey, clientId and clientSecret\", function () {",
									"    pm.expect(jsonData).to.have.property(\"clientId\");",
									"    pm.expect(jsonData).to.have.property(\"clientSecret\");",
									"    pm.expect(jsonData).to.have.property(\"apiKey\");",
									"});",
									"",
									"if (jsonData && jsonData.clientId && jsonData.clientSecret) {",
									"    pm.collectionVariables.set(\"tenant_clientId\", jsonData.clientId);",
									"    pm.collectionVariables.set(\"tenant_clientSecret\", jsonData.clientSecret);",
									"    pm.collectionVariables.set(\"tenant_apiKey\", jsonData.apiKey);",
									"} "
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"roles\": [],\n    \"serviceEndpoints\": [\n        {\n            \"type\": \"CredentialService\",\n            \"serviceEndpoint\": \"http://identityhub.edc-v.svc.cluster.local:7082/api/credentials/v1/participants/Y29uc3VtZXI=\",\n            \"id\": \"consumer-credentialservice-1\"\n        },\n        {\n            \"type\": \"ProtocolEndpoint\",\n            \"serviceEndpoint\": \"http://controlplane:8082/api/dsp/consumer/2025-1\",\n            \"id\": \"consumer-dsp\"\n        }\n    ],\n    \"active\": true,\n    \"participantContextId\": \"consumer\",\n    \"did\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer\",\n    \"key\": {\n        \"keyId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer#key-1\",\n        \"privateKeyAlias\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer#key-1\",\n        \"keyGeneratorParams\": {\n            \"algorithm\": \"EC\"\n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cs/api/identity/v1alpha/participants",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cs",
								"api",
								"identity",
								"v1alpha",
								"participants"
							]
						}
					},
					"response": []
				},
				{
					"name": "Request Credentials",
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"issuerDid\": \"did:web:issuerservice.edc-v.svc.cluster.local%3A10016:issuer\",\n    \"holderPid\": \"credential-request-5\",\n    \"credentials\": [{\n        \"format\": \"VC1_0_JWT\",\n        \"type\": \"MembershipCredential\",\n        \"id\": \"membership-credential-def\"\n    }]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cs/api/identity/v1alpha/participants/Y29uc3VtZXI=/credentials/request",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cs",
								"api",
								"identity",
								"v1alpha",
								"participants",
								"Y29uc3VtZXI=",
								"credentials",
								"request"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Tenant in Control Plane",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"participantContextId\": \"consumer\",\n    \"participantId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:consumer\",\n    \"isActive\": true,\n    \"tokenUrl\": \"http://identityhub.edc-v.svc.cluster.local:7084/api/sts/token\",\n    \"clientSecret\": \"{{tenant_clientSecret}}\",\n    \"clientId\": \"{{tenant_clientId}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cp/api/mgmt/v1alpha/participants",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cp",
								"api",
								"mgmt",
								"v1alpha",
								"participants"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Create Provider Tenant",
			"item": [
				{
					"name": "Create Provider Holder in IssuerService",
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"did\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\",\n    \"holderId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\",\n    \"name\": \"provider tenant\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/issuer/admin/api/admin/v1alpha/participants/aXNzdWVy/holders",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"issuer",
								"admin",
								"api",
								"admin",
								"v1alpha",
								"participants",
								"aXNzdWVy",
								"holders"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Provider Tenant in IdentityHub",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Parse JSON response and store clientId and clientSecret as collection variables",
									"let jsonData;",
									"",
									"pm.test(\"Response is valid JSON\", function () {",
									"    try {",
									"        jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.be.an(\"object\");",
									"    } catch (e) {",
									"        throw new Error(\"Response body is not valid JSON\");",
									"    }",
									"});",
									"",
									"pm.test(\"Response contains apiKey, clientId and clientSecret\", function () {",
									"    pm.expect(jsonData).to.have.property(\"clientId\");",
									"    pm.expect(jsonData).to.have.property(\"clientSecret\");",
									"    pm.expect(jsonData).to.have.property(\"apiKey\");",
									"});",
									"",
									"if (jsonData && jsonData.clientId && jsonData.clientSecret) {",
									"    pm.collectionVariables.set(\"tenant_clientId\", jsonData.clientId);",
									"    pm.collectionVariables.set(\"tenant_clientSecret\", jsonData.clientSecret);",
									"    pm.collectionVariables.set(\"tenant_apiKey\", jsonData.apiKey);",
									"} "
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"roles\": [],\n    \"serviceEndpoints\": [\n        {\n            \"type\": \"CredentialService\",\n            \"serviceEndpoint\": \"http://identityhub.edc-v.svc.cluster.local:7082/api/credentials/v1/participants/cHJvdmlkZXI=\",\n            \"id\": \"provider-credentialservice-1\"\n        },\n        {\n            \"type\": \"ProtocolEndpoint\",\n            \"serviceEndpoint\": \"http://controlplane.edc-v.svc.cluster.local:8082/api/dsp/provider/2025-1\",\n            \"id\": \"provider-dsp\"\n        }\n    ],\n    \"active\": true,\n    \"participantId\": \"provider\",\n    \"participantContextId\": \"provider\",\n    \"did\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\",\n    \"key\": {\n        \"keyId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider#key-1\",\n        \"privateKeyAlias\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider#key-1\",\n        \"keyGeneratorParams\": {\n            \"algorithm\": \"EC\"\n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cs/api/identity/v1alpha/participants",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cs",
								"api",
								"identity",
								"v1alpha",
								"participants"
							]
						}
					},
					"response": []
				},
				{
					"name": "Request Credentials",
					"request": {
						"auth": {
							"type": "apikey",
							"apikey": [
								{
									"key": "value",
									"value": "c3VwZXItdXNlcg==.c3VwZXItc2VjcmV0LWtleQo=",
									"type": "string"
								},
								{
									"key": "key",
									"value": "x-api-key",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"issuerDid\": \"did:web:issuerservice.edc-v.svc.cluster.local%3A10016:issuer\",\n    \"holderPid\": \"credential-request-1\",\n    \"credentials\": [{\n        \"format\": \"VC1_0_JWT\",\n        \"type\": \"MembershipCredential\",\n        \"id\": \"membership-credential-def\"\n    }]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cs/api/identity/v1alpha/participants/cHJvdmlkZXI=/credentials/request",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cs",
								"api",
								"identity",
								"v1alpha",
								"participants",
								"cHJvdmlkZXI=",
								"credentials",
								"request"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Provider in Control Plane",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"participantContextId\": \"provider\",\n    \"participantId\": \"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\",\n    \"isActive\": true,\n    \"tokenUrl\": \"http://identityhub.edc-v.svc.cluster.local:7084/api/sts/token\",\n    \"clientSecret\": \"{{tenant_clientSecret}}\",\n    \"clientId\": \"{{tenant_clientId}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseURL}}/cp/api/mgmt/v1alpha/participants",
							"host": [
								"{{baseURL}}"
							],
							"path": [
								"cp",
								"api",
								"mgmt",
								"v1alpha",
								"participants"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Get Catalog",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"try {",
							"    const json = pm.response.json();",
							"",
							"    // Navigate the expected structure: Catalog -> dataset[0] -> hasPolicy[0] -> @id",
							"    const datasets = json.dataset || [];",
							"    const firstDataset = datasets[0] || {};",
							"    const policies = firstDataset.hasPolicy || [];",
							"    const firstPolicy = policies[0] || {};",
							"    const policyId = firstPolicy['@id'];",
							"",
							"    if (policyId && typeof policyId === 'string') {",
							"        pm.collectionVariables.set('POLICY_ID', policyId);",
							"        console.log('POLICY_ID set to:', policyId);",
							"    } else {",
							"        console.warn('Policy ID not found in response at dataset[0].hasPolicy[0][\"@id\"]');",
							"    }",
							"",
							"    // Optional: assertion to ensure it exists",
							"    pm.test('Policy ID is present and stored', function () {",
							"        pm.expect(policyId, 'Policy ID should exist').to.be.a('string').and.not.empty;",
							"    });",
							"",
							"} catch (e) {",
							"    console.error('Failed to parse response or set POLICY_ID:', e);",
							"    pm.test('Response is valid JSON', function () {",
							"        throw e;",
							"    });",
							"}"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\n\"counterPartyDid\":\"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseURL}}/cp/api/mgmt/v1alpha/participants/consumer/catalog",
					"host": [
						"{{baseURL}}"
					],
					"path": [
						"cp",
						"api",
						"mgmt",
						"v1alpha",
						"participants",
						"consumer",
						"catalog"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get Data",
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"providerId\":\"did:web:identityhub.edc-v.svc.cluster.local%3A7083:provider\",\n    \"policyId\": \"{{POLICY_ID}}\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseURL}}/cp/api/mgmt/v1alpha/participants/consumer/data",
					"host": [
						"{{baseURL}}"
					],
					"path": [
						"cp",
						"api",
						"mgmt",
						"v1alpha",
						"participants",
						"consumer",
						"data"
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseURL",
			"value": ""
		},
		{
			"key": "issuer_apiKey",
			"value": ""
		},
		{
			"key": "issuer_clientId",
			"value": ""
		},
		{
			"key": "issuer_clientSecret",
			"value": ""
		},
		{
			"key": "tenant_clientId",
			"value": ""
		},
		{
			"key": "tenant_clientSecret",
			"value": ""
		},
		{
			"key": "tenant_apiKey",
			"value": ""
		},
		{
			"key": "POLICY_ID",
			"value": ""
		}
	]
}